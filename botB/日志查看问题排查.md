# 日志查看问题排查指南

## 🔍 常见问题

### 1. 服务名称不对

根据 `otc-bot.service` 文件，服务名称是 **`otc-bot`**，不是 `wushipay-bot`。

**正确的命令：**
```bash
# 实时查看日志
sudo journalctl -u otc-bot -f

# 查看最近日志
sudo journalctl -u otc-bot -n 100
```

### 2. 服务没有运行

如果使用 `-f` 参数没有输出，可能是服务没有运行。

**检查服务状态：**
```bash
# 检查服务是否运行
sudo systemctl status otc-bot

# 如果服务没有运行，启动它
sudo systemctl start otc-bot

# 查看服务是否启用
sudo systemctl is-enabled otc-bot
```

### 3. 没有新日志

如果使用 `-f` 参数没有立即显示内容，可能是：
- 服务刚启动，还没有新日志产生
- 服务没有活动，所以没有新日志

**解决方案：**
```bash
# 先查看最近的日志（不实时）
sudo journalctl -u otc-bot -n 50

# 然后查看实时日志
sudo journalctl -u otc-bot -f
```

### 4. 查找正确的服务名称

如果不确定服务名称，可以：

```bash
# 查找所有 bot 相关服务
sudo systemctl list-units | grep -i bot

# 或者查找所有服务文件
ls /etc/systemd/system/*.service | grep -i bot
```

## 📋 完整的排查步骤

### 步骤 1：确认服务名称
```bash
# 查看服务文件
cat /etc/systemd/system/otc-bot.service

# 或者查找服务
sudo systemctl list-units --type=service | grep -i bot
```

### 步骤 2：检查服务状态
```bash
# 查看服务状态
sudo systemctl status otc-bot

# 如果服务没有运行，启动它
sudo systemctl start otc-bot

# 如果服务失败，查看错误信息
sudo systemctl status otc-bot -l
```

### 步骤 3：查看日志
```bash
# 方法1：查看最近的日志（推荐先执行这个）
sudo journalctl -u otc-bot -n 100 --no-pager

# 方法2：查看今天的日志
sudo journalctl -u otc-bot --since today --no-pager

# 方法3：实时查看日志（如果有新日志会显示）
sudo journalctl -u otc-bot -f
```

### 步骤 4：如果还是没有日志

检查服务是否真的在运行：
```bash
# 查看进程
ps aux | grep python | grep bot

# 查看端口（如果bot使用webhook）
sudo netstat -tlnp | grep python
```

## 🚀 快速诊断命令

一键检查所有信息：
```bash
echo "=== 服务状态 ===" && \
sudo systemctl status otc-bot --no-pager -l && \
echo -e "\n=== 最近 50 行日志 ===" && \
sudo journalctl -u otc-bot -n 50 --no-pager && \
echo -e "\n=== 服务是否运行 ===" && \
sudo systemctl is-active otc-bot
```

## 💡 常见错误解决

### 错误1：`.sudo` 命令未找到
**原因：** 命令前多了一个点 `.`

**解决：** 使用 `sudo` 而不是 `.sudo`

### 错误2：`-f` 没有输出
**原因：** 
- 服务没有运行
- 没有新日志产生
- 服务名称不对

**解决：**
1. 先检查服务状态：`sudo systemctl status otc-bot`
2. 查看历史日志：`sudo journalctl -u otc-bot -n 100`
3. 确认服务名称正确

### 错误3：权限不足
**原因：** 没有使用 `sudo`

**解决：** 所有 `journalctl` 命令都需要 `sudo`

## 📝 推荐的日志查看流程

1. **先查看服务状态**
   ```bash
   sudo systemctl status otc-bot
   ```

2. **查看最近的日志**
   ```bash
   sudo journalctl -u otc-bot -n 100
   ```

3. **如果需要实时监控，使用 `-f`**
   ```bash
   sudo journalctl -u otc-bot -f
   ```

4. **如果还是没有输出，检查服务是否真的在运行**
   ```bash
   ps aux | grep python | grep bot
   ```
