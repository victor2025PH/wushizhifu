"""
Button help service for Bot B
Provides help information for each button
"""
from typing import Dict, Optional
from database import db

# Button help content
BUTTON_HELP: Dict[str, Dict[str, str]] = {
    "ğŸ’± æ±‡ç‡": {
        "title": "ğŸ’± æ±‡ç‡æŸ¥è¯¢",
        "description": "æŸ¥çœ‹å®æ—¶ USDT/CNY æ±‡ç‡å’Œå¸å®‰ P2P å•†æˆ·æŠ¥ä»·",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç‚¹å‡»ã€ŒğŸ’± æ±‡ç‡ã€æŒ‰é’®\n"
            "2. é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼ˆé“¶è¡Œå¡/æ”¯ä»˜å®/å¾®ä¿¡ï¼‰\n"
            "3. æŸ¥çœ‹å®æ—¶å•†æˆ·æŠ¥ä»·åˆ—è¡¨\n"
            "4. ä½¿ç”¨ç¿»é¡µæŒ‰é’®æŸ¥çœ‹æ›´å¤šå•†æˆ·\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šæ±‡ç‡æ•°æ®æ¥è‡ªå¸å®‰ P2Pï¼Œå®æ—¶æ›´æ–°</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ å®æ—¶å¸å®‰ P2P å•†æˆ·æŠ¥ä»·\n"
            "â€¢ æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼åˆ‡æ¢\n"
            "â€¢ æ˜¾ç¤ºå•†æˆ·é™é¢å’Œæˆå•æ•°\n"
            "â€¢ ä¸“ä¸šå¸‚åœºç»Ÿè®¡æ•°æ®"
        )
    },
    "ğŸ’° ç»“ç®—": {
        "title": "ğŸ’° ç»“ç®—è®¡ç®—",
        "description": "å¿«é€Ÿè®¡ç®—äººæ°‘å¸é‡‘é¢å¯¹åº”çš„ USDT ç»“ç®—æ•°é‡",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç‚¹å‡»ã€ŒğŸ’° ç»“ç®—ã€æŒ‰é’®\n"
            "2. é€‰æ‹©é‡‘é¢æ¨¡æ¿æˆ–ç®—å¼æ¨¡æ¿\n"
            "3. æˆ–ç›´æ¥è¾“å…¥é‡‘é¢ï¼ˆå¦‚ï¼š10000ï¼‰\n"
            "4. æˆ–è¾“å…¥ç®—å¼ï¼ˆå¦‚ï¼š20000-200ï¼‰\n"
            "5. ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—å¹¶ç”Ÿæˆç»“ç®—å•\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šæ”¯æŒæ‰¹é‡ç»“ç®—ï¼Œç”¨é€—å·åˆ†éš”å¤šä¸ªé‡‘é¢</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ å¿«é€Ÿç»“ç®—è®¡ç®—\n"
            "â€¢ æ”¯æŒé‡‘é¢æ¨¡æ¿å’Œç®—å¼æ¨¡æ¿\n"
            "â€¢ è‡ªåŠ¨è®°å½•äº¤æ˜“\n"
            "â€¢ æ”¯æŒæ‰¹é‡ç»“ç®—"
        )
    },
    "ğŸ“Š ä»Šæ—¥": {
        "title": "ğŸ“Š ä»Šæ—¥è´¦å•",
        "description": "æŸ¥çœ‹ç¾¤ç»„ä»Šæ—¥çš„äº¤æ˜“ç»Ÿè®¡å’Œè´¦å•åˆ—è¡¨",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. åœ¨ç¾¤ç»„ä¸­ç‚¹å‡»ã€ŒğŸ“Š ä»Šæ—¥ã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹ä»Šæ—¥äº¤æ˜“ç»Ÿè®¡\n"
            "3. æŸ¥çœ‹æœ€è¿‘ 5 ç¬”äº¤æ˜“è®°å½•\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šä»…ç¾¤ç»„å¯ç”¨ï¼Œæ˜¾ç¤ºå½“æ—¥æ‰€æœ‰äº¤æ˜“</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ å®æ—¶äº¤æ˜“ç»Ÿè®¡\n"
            "â€¢ äº¤æ˜“æ¬¡æ•°å’Œæ€»é‡‘é¢\n"
            "â€¢ æœ€è¿‘äº¤æ˜“è®°å½•\n"
            "â€¢ ç¾¤ç»„ä¸“å±åŠŸèƒ½"
        )
    },
    "ğŸ“œ å†å²": {
        "title": "ğŸ“œ å†å²è´¦å•",
        "description": "æŸ¥çœ‹ç¾¤ç»„çš„å†å²äº¤æ˜“è®°å½•ï¼Œæ”¯æŒåˆ†é¡µæµè§ˆ",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. åœ¨ç¾¤ç»„ä¸­ç‚¹å‡»ã€ŒğŸ“œ å†å²ã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹å†å²äº¤æ˜“åˆ—è¡¨ï¼ˆåˆ†é¡µæ˜¾ç¤ºï¼‰\n"
            "3. ä½¿ç”¨ç¿»é¡µæŒ‰é’®æŸ¥çœ‹æ›´å¤š\n"
            "4. ç‚¹å‡»äº¤æ˜“å¯æŸ¥çœ‹è¯¦æƒ…\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šä»…ç¾¤ç»„å¯ç”¨ï¼Œæ”¯æŒåˆ†é¡µæµè§ˆ</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ å®Œæ•´å†å²è®°å½•\n"
            "â€¢ åˆ†é¡µæµè§ˆ\n"
            "â€¢ äº¤æ˜“è¯¦æƒ…æŸ¥çœ‹\n"
            "â€¢ é«˜çº§æœç´¢ç­›é€‰"
        )
    },
    "ğŸ“œ æˆ‘çš„è´¦å•": {
        "title": "ğŸ“œ æˆ‘çš„è´¦å•",
        "description": "æŸ¥çœ‹æ‚¨ä¸ªäººçš„æ‰€æœ‰äº¤æ˜“è®°å½•",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. åœ¨ç§èŠä¸­ç‚¹å‡»ã€ŒğŸ“œ æˆ‘çš„è´¦å•ã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹æ‚¨çš„æ‰€æœ‰äº¤æ˜“è®°å½•\n"
            "3. ä½¿ç”¨ç¿»é¡µæŒ‰é’®æŸ¥çœ‹æ›´å¤š\n"
            "4. ç‚¹å‡»äº¤æ˜“å¯æŸ¥çœ‹è¯¦æƒ…\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šä»…ç§èŠå¯ç”¨ï¼Œæ˜¾ç¤ºæ‚¨çš„æ‰€æœ‰äº¤æ˜“</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ ä¸ªäººäº¤æ˜“è®°å½•\n"
            "â€¢ åˆ†é¡µæµè§ˆ\n"
            "â€¢ äº¤æ˜“è¯¦æƒ…æŸ¥çœ‹\n"
            "â€¢ çŠ¶æ€è·Ÿè¸ª"
        )
    },
    "ğŸ”— åœ°å€": {
        "title": "ğŸ”— æ”¶æ¬¾åœ°å€",
        "description": "æŸ¥çœ‹ USDT æ”¶æ¬¾åœ°å€ï¼ˆç¾¤ç»„æˆ–å…¨å±€ï¼‰",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç‚¹å‡»ã€ŒğŸ”— åœ°å€ã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹å½“å‰ç¾¤ç»„æˆ–å…¨å±€çš„ USDT æ”¶æ¬¾åœ°å€\n"
            "3. å¤åˆ¶åœ°å€ç”¨äºè½¬è´¦\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šç¾¤ç»„ä¼˜å…ˆä½¿ç”¨ç¾¤ç»„åœ°å€ï¼Œå¦åˆ™ä½¿ç”¨å…¨å±€åœ°å€</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ å¿«é€ŸæŸ¥çœ‹åœ°å€\n"
            "â€¢ ç¾¤ç»„ç‹¬ç«‹åœ°å€\n"
            "â€¢ å…¨å±€é»˜è®¤åœ°å€\n"
            "â€¢ åœ°å€å®‰å…¨æ˜¾ç¤º"
        )
    },
    "ğŸ“ å®¢æœ": {
        "title": "ğŸ“ è”ç³»å®¢æœ",
        "description": "è·å–äººå·¥å®¢æœè”ç³»æ–¹å¼",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç‚¹å‡»ã€ŒğŸ“ å®¢æœã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹å®¢æœè”ç³»æ–¹å¼\n"
            "3. è”ç³»ç®¡ç†å‘˜è·å–å¸®åŠ©\n\n"
            "ğŸ’¡ <i>æç¤ºï¼š7Ã—24å°æ—¶åœ¨çº¿æœåŠ¡</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ å¿«é€Ÿè”ç³»å®¢æœ\n"
            "â€¢ 7Ã—24å°æ—¶æœåŠ¡\n"
            "â€¢ å¿«é€Ÿå“åº”\n"
            "â€¢ ä¸“ä¸šæ”¯æŒ"
        )
    },
    "ğŸ”” é¢„è­¦": {
        "title": "ğŸ”” ä»·æ ¼é¢„è­¦",
        "description": "è®¾ç½®ä»·æ ¼é¢„è­¦ï¼Œå½“æ±‡ç‡è¾¾åˆ°è®¾å®šå€¼æ—¶è‡ªåŠ¨é€šçŸ¥",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç‚¹å‡»ã€ŒğŸ”” é¢„è­¦ã€æŒ‰é’®\n"
            "2. åˆ›å»ºä»·æ ¼é¢„è­¦\n"
            "3. é€‰æ‹©é¢„è­¦ç±»å‹ï¼ˆé«˜äº/ä½äºï¼‰\n"
            "4. è®¾ç½®é¢„è­¦ä»·æ ¼é˜ˆå€¼\n"
            "5. å½“ä»·æ ¼è¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨é€šçŸ¥\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šæ”¯æŒå¤šä¸ªé¢„è­¦ï¼Œå®æ—¶ç›‘æ§ä»·æ ¼å˜åŒ–</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ ä»·æ ¼å®æ—¶ç›‘æ§\n"
            "â€¢ è‡ªåŠ¨é€šçŸ¥æé†’\n"
            "â€¢ æ”¯æŒå¤šä¸ªé¢„è­¦\n"
            "â€¢ çµæ´»é˜ˆå€¼è®¾ç½®"
        )
    },
    "âš™ï¸ è®¾ç½®": {
        "title": "âš™ï¸ ç¾¤ç»„è®¾ç½®",
        "description": "ç®¡ç†å‘˜ä¸“ç”¨ï¼šé…ç½®ç¾¤ç»„çš„åŠ ä»·å’Œæ”¶æ¬¾åœ°å€",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç®¡ç†å‘˜ç‚¹å‡»ã€Œâš™ï¸ è®¾ç½®ã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹ç¾¤ç»„è®¾ç½®èœå•\n"
            "3. è®¾ç½®ç¾¤ç»„åŠ ä»·\n"
            "4. è®¾ç½®ç¾¤ç»„æ”¶æ¬¾åœ°å€\n"
            "5. æŸ¥çœ‹å¾…æ”¯ä»˜/å¾…ç¡®è®¤äº¤æ˜“\n"
            "6. å¯¼å‡ºæŠ¥è¡¨å’ŒæŸ¥çœ‹æ—¥å¿—\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œç¾¤ç»„ç‹¬ç«‹é…ç½®</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ ç¾¤ç»„ç‹¬ç«‹é…ç½®\n"
            "â€¢ åŠ ä»·å’Œåœ°å€ç®¡ç†\n"
            "â€¢ äº¤æ˜“ç®¡ç†\n"
            "â€¢ æ•°æ®å¯¼å‡º"
        )
    },
    "âš™ï¸ ç®¡ç†": {
        "title": "âš™ï¸ å…¨å±€ç®¡ç†",
        "description": "ç®¡ç†å‘˜ä¸“ç”¨ï¼šé…ç½®å…¨å±€é»˜è®¤è®¾ç½®å’ŒæŸ¥çœ‹æ‰€æœ‰ç¾¤ç»„",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç®¡ç†å‘˜åœ¨ç§èŠä¸­ç‚¹å‡»ã€Œâš™ï¸ ç®¡ç†ã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹å…¨å±€ç®¡ç†èœå•\n"
            "3. è®¾ç½®å…¨å±€é»˜è®¤åŠ ä»·\n"
            "4. è®¾ç½®å…¨å±€é»˜è®¤åœ°å€\n"
            "5. æŸ¥çœ‹æ‰€æœ‰ç¾¤ç»„åˆ—è¡¨\n"
            "6. æŸ¥çœ‹å…¨å±€ç»Ÿè®¡\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œå½±å“æ‰€æœ‰æœªé…ç½®ç‹¬ç«‹è®¾ç½®çš„ç¾¤ç»„</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ å…¨å±€é»˜è®¤é…ç½®\n"
            "â€¢ æ‰€æœ‰ç¾¤ç»„ç®¡ç†\n"
            "â€¢ å…¨å±€ç»Ÿè®¡\n"
            "â€¢ é›†ä¸­ç®¡ç†"
        )
    },
    "ğŸ“ˆ ç»Ÿè®¡": {
        "title": "ğŸ“ˆ ç¾¤ç»„ç»Ÿè®¡",
        "description": "ç®¡ç†å‘˜ä¸“ç”¨ï¼šæŸ¥çœ‹ç¾¤ç»„çš„è¯¦ç»†ç»Ÿè®¡æ•°æ®",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç®¡ç†å‘˜åœ¨ç¾¤ç»„ä¸­ç‚¹å‡»ã€ŒğŸ“ˆ ç»Ÿè®¡ã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹ç¾¤ç»„äº¤æ˜“ç»Ÿè®¡\n"
            "3. æŸ¥çœ‹å¾…æ”¯ä»˜/å¾…ç¡®è®¤äº¤æ˜“\n"
            "4. å¯¼å‡ºç»Ÿè®¡æ•°æ®\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œç¾¤ç»„ä¸“å±ç»Ÿè®¡</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ è¯¦ç»†äº¤æ˜“ç»Ÿè®¡\n"
            "â€¢ å¾…å¤„ç†äº¤æ˜“ç®¡ç†\n"
            "â€¢ æ•°æ®å¯¼å‡º\n"
            "â€¢ å¯è§†åŒ–å›¾è¡¨"
        )
    },
    "ğŸ“Š æ•°æ®": {
        "title": "ğŸ“Š å…¨å±€æ•°æ®",
        "description": "ç®¡ç†å‘˜ä¸“ç”¨ï¼šæŸ¥çœ‹å…¨å±€ç»Ÿè®¡æ•°æ®å’Œå¯è§†åŒ–å›¾è¡¨",
        "usage": (
            "ğŸ“– <b>ä½¿ç”¨æ–¹æ³•ï¼š</b>\n\n"
            "1. ç®¡ç†å‘˜åœ¨ç§èŠä¸­ç‚¹å‡»ã€ŒğŸ“Š æ•°æ®ã€æŒ‰é’®\n"
            "2. æŸ¥çœ‹å…¨å±€ç»Ÿè®¡æ•°æ®\n"
            "3. æŸ¥çœ‹æ•°æ®å¯è§†åŒ–å›¾è¡¨\n"
            "4. å¯¼å‡ºå…¨å±€æ•°æ®\n\n"
            "ğŸ’¡ <i>æç¤ºï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œå…¨å±€æ•°æ®ç»Ÿè®¡</i>"
        ),
        "features": (
            "âœ¨ <b>åŠŸèƒ½ç‰¹ç‚¹ï¼š</b>\n"
            "â€¢ å…¨å±€æ•°æ®ç»Ÿè®¡\n"
            "â€¢ å¯è§†åŒ–å›¾è¡¨\n"
            "â€¢ æ•°æ®å¯¼å‡º\n"
            "â€¢ å¤šç»´åº¦åˆ†æ"
        )
    }
}


def get_button_help(button_text: str) -> Optional[Dict[str, str]]:
    """
    Get help information for a button.
    
    Args:
        button_text: Button text
        
    Returns:
        Dictionary with help information or None
    """
    return BUTTON_HELP.get(button_text)


def format_button_help_message(button_text: str) -> Optional[str]:
    """
    Format help message for a button.
    
    Args:
        button_text: Button text
        
    Returns:
        Formatted help message or None
    """
    help_info = get_button_help(button_text)
    if not help_info:
        return None
    
    message = f"{help_info['title']}\n\n"
    message += f"ğŸ“ <b>åŠŸèƒ½è¯´æ˜ï¼š</b>\n{help_info['description']}\n\n"
    message += help_info['usage'] + "\n\n"
    message += help_info['features']
    
    return message


def should_show_help(user_id: int, button_text: str) -> bool:
    """
    Check if help should be shown for a button.
    
    Args:
        user_id: User ID
        button_text: Button text
        
    Returns:
        True if help should be shown
    """
    # Check user preference
    help_key = f"button_help_shown_{button_text}"
    help_shown = db.get_user_setting(user_id, help_key)
    
    # If help was never shown, show it
    if help_shown is None:
        return True
    
    # If user explicitly disabled help, don't show
    if help_shown == "false":
        return False
    
    # Otherwise, show help (user can close it)
    return True


def mark_help_shown(user_id: int, button_text: str, shown: bool = True):
    """
    Mark help as shown or hidden for a button.
    
    Args:
        user_id: User ID
        button_text: Button text
        shown: Whether help was shown (True) or hidden (False)
    """
    help_key = f"button_help_shown_{button_text}"
    db.set_user_preference(user_id, help_key, "true" if shown else "false")


def reset_all_help(user_id: int):
    """
    Reset all button help preferences (show all help again).
    
    Args:
        user_id: User ID
    """
    for button_text in BUTTON_HELP.keys():
        help_key = f"button_help_shown_{button_text}"
        db.set_user_preference(user_id, help_key, None)

