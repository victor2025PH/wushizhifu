# Bot B UI 功能说明

## 功能 1: 持久菜单（ReplyKeyboard）

### /start 命令

当用户发送 `/start` 命令时，Bot 会显示欢迎消息和持久菜单按钮。

**菜单按钮：**
- 📊 查看汇率
- 🔗 收款地址  
- 📞 联系人工

**功能映射：**

#### 📊 查看汇率
- **管理员**: 显示完整价格信息（OKX 基础价格 + 管理员加价 + 最终价格）
- **普通用户**: 仅显示当前汇率

#### 🔗 收款地址
- 显示 USDT 收款地址（所有用户可用）

#### 📞 联系人工
- 显示客服联系方式
- 管理员：@wushizhifu_jianglai
- 工作时间：7×24小时

---

## 功能 2: 结算账单模板（收据样式）

### 账单格式

当用户发送数字或数学表达式时，自动生成格式化的结算账单：

```
🧾 交易结算单
────────────────────────

💰 数量: 2,000.00 U
📊 汇率: 7.7345 (OKX: 7.2345 +0.5000)
🇨🇳 应付: 15,469.00 CNY

────────────────────────

🔗 地址: TYourUSDTAddressHere123456789
```

### 账单特点

1. **收据样式布局**
   - 使用分隔线（────────）美化
   - 清晰的标题和字段标签
   - 使用表情符号增强视觉效果

2. **汇率明细**
   - 显示最终汇率
   - 括号内显示 OKX 基础价格和管理员调整
   - 格式：`最终汇率 (OKX: 基础价格 ±加价)`

3. **自动包含 USDT 地址**
   - 如果数据库中设置了 USDT 地址，自动显示在账单底部

### 确认按钮（✅ 已核对）

账单下方有一个内联键盘按钮：

**功能：**
- 点击 "✅ 已核对" 按钮
- Bot 会在消息底部添加 "(已确认)" 标记
- 按钮变为已点击状态（显示确认提示）

**示例：**
```
原始账单...
────────────────────────

[✅ 已核对]  ← 点击此按钮

点击后：

原始账单...
────────────────────────

✅ (已确认)  ← 自动添加
```

---

## 使用流程示例

### 场景 1: 用户查看汇率

1. 用户发送 `/start`
2. Bot 显示欢迎消息和菜单按钮
3. 用户点击 "📊 查看汇率"
4. Bot 显示当前汇率

### 场景 2: 用户计算结算

1. 用户发送数字：`2000`
2. Bot 自动计算并显示结算账单
3. 账单包含：
   - 交易数量
   - 汇率明细
   - 应付总额
   - USDT 收款地址
4. 用户可以点击 "✅ 已核对" 确认

### 场景 3: 管理员设置加价

1. 管理员发送：`w02 0.5`
2. Bot 回复：`✅ 管理员加价已设置为: 0.5000 CNY`
3. 之后所有结算都会使用新加价

---

## 技术实现

### ReplyKeyboard
- 使用 `ReplyKeyboardMarkup`
- `resize_keyboard=True` - 自适应按钮大小
- `persistent=True` - 持久显示菜单
- `one_time_keyboard=False` - 菜单始终可见

### 账单格式化
- 使用 HTML 格式（`<b>`, `<code>` 标签）
- 货币格式化（千位分隔符）
- 自动包含 USDT 地址

### 确认按钮
- 使用 `InlineKeyboardButton`
- Callback 处理器编辑原消息
- 添加确认标记并移除按钮

---

## 视觉设计

### 账单样式
- 标题：🧾 交易结算单（粗体）
- 分隔线：────────
- 代码样式：数量、地址使用 `<code>` 标签
- 粗体：应付总额使用 `<b>` 标签

### 响应式
- 按钮自适应屏幕大小
- 支持移动端和桌面端显示

