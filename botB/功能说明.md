# Bot B 功能说明

## 管理员快捷命令

### w01 - 获取当前价格
**格式**: `w01`

**功能**: 获取当前 OKX 价格 + 管理员加价

**回复**: 显示基础价格、管理员加价和最终价格

**示例**:
```
用户: w01
Bot: 💱 当前价格信息

📊 OKX 基础价格: 7.2345 CNY
➕ 管理员加价: 0.5000 CNY
💰 最终价格: 7.7345 CNY
```

---

### w02 - 设置管理员加价
**格式**: `w02 [数字]`

**功能**: 设置管理员加价（可以是正数或负数）

**参数**:
- `[数字]`: 加价值（可以是小数，如 0.5 或 -0.3）

**示例**:
```
用户: w02 0.5
Bot: ✅ 管理员加价已设置为: 0.5000 CNY

用户: w02 -0.2
Bot: ✅ 管理员加价已设置为: -0.2000 CNY
```

---

### w03 - 设置降价
**格式**: `w03 [数字]`

**功能**: 设置降价（自动转为负数加价）

**参数**:
- `[数字]`: 降价值（必须是正数，系统自动转为负数）

**示例**:
```
用户: w03 0.3
Bot: ✅ 降价已设置为: -0.3000 CNY (加价: -0.3000 CNY)
```

---

### w04 - 获取 USDT 地址
**格式**: `w04`

**功能**: 获取当前设置的 USDT 收款地址

**回复**: 显示 USDT 地址（如果有）或提示未设置

**示例**:
```
用户: w04
Bot: 💼 USDT 收款地址:

TYourUSDTAddressHere123456789
```

---

### w08 - 重置加价
**格式**: `w08`

**功能**: 将管理员加价重置为 0

**示例**:
```
用户: w08
Bot: ✅ 管理员加价已重置为 0
```

---

## 数学和结算功能

### 纯数字输入
**格式**: 发送纯数字（如 `2000`）

**功能**: 自动计算结算账单

**示例**:
```
用户: 2000
Bot: 📋 结算账单

交易数量: 2,000.00 USDT
基础汇率: 7.2345 CNY
管理员调整: +0.5000 CNY
最终汇率: 7.7345 CNY

💵 应付总额: 15,469.00 CNY
```

---

### 数学表达式
**格式**: 发送简单数学表达式（如 `29981-125`）

**支持的操作**:
- 加法: `100+50`
- 减法: `29981-125`
- 乘法: `200*2`
- 除法: `1000/2`

**示例**:
```
用户: 29981-125
Bot: 📋 结算账单

交易数量: 29,856.00 USDT
基础汇率: 7.2345 CNY
管理员调整: +0.5000 CNY
最终汇率: 7.7345 CNY

💵 应付总额: 231,016.83 CNY
```

---

## 使用说明

### 管理员命令权限
- 所有 `w0X` 命令仅限管理员使用
- 管理员 ID 在 `config.py` 中的 `INITIAL_ADMINS` 配置

### 数学表达式限制
- 只支持单个运算符（如 `a+b`，不支持 `a+b-c`）
- 支持小数（如 `100.5+50.25`）
- 自动处理负数（如 `-100+50`）

### 价格获取
- 自动从 OKX API 获取实时价格
- 如果 API 失败，使用默认回退价格（7.20 CNY）
- 会显示价格获取的警告信息

---

## 技术细节

### 安全性
- 不使用 `eval()` 函数
- 使用正则表达式验证数学表达式
- 限制只支持简单四则运算

### 错误处理
- 无效的数学表达式会返回错误提示
- 价格获取失败时会使用回退价格
- 所有错误都会记录日志

