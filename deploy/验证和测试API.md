# API æœåŠ¡éªŒè¯å’Œæµ‹è¯•æŒ‡å—

## âœ… å®ŒæˆçŠ¶æ€æ£€æŸ¥

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
sudo systemctl status wushipay-api
```

**é¢„æœŸç»“æœ**ï¼š
- `Active: active (running)` - æœåŠ¡æ­£åœ¨è¿è¡Œ
- æ²¡æœ‰é”™è¯¯ä¿¡æ¯

**å¦‚æœå¤±è´¥**ï¼š
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š`sudo journalctl -u wushipay-api -n 50`
- è¿è¡Œè¯Šæ–­è„šæœ¬ï¼š`./è¯Šæ–­å¹¶ä¿®å¤APIæœåŠ¡.sh`

### 2. æ£€æŸ¥æœåŠ¡æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u wushipay-api -f

# æŸ¥çœ‹æœ€è¿‘50è¡Œ
sudo journalctl -u wushipay-api -n 50
```

**é¢„æœŸç»“æœ**ï¼š
- çœ‹åˆ° "Application startup complete"
- æ²¡æœ‰é”™è¯¯ä¿¡æ¯

### 3. æµ‹è¯• API ç«¯ç‚¹

#### æµ‹è¯•æ ¹è·¯å¾„ï¼ˆå¥åº·æ£€æŸ¥ï¼‰

```bash
curl http://127.0.0.1:8000/
```

**é¢„æœŸç»“æœ**ï¼š
```json
{"status":"ok","service":"WuShiPay API","version":"1.0.0"}
```

#### æµ‹è¯•è§†é¢‘ç«¯ç‚¹ï¼ˆéœ€è¦è®¤è¯ï¼Œå¯èƒ½è¿”å› 401 æˆ– 404ï¼‰

```bash
# æµ‹è¯•æ”¯ä»˜å®è§†é¢‘ç«¯ç‚¹
curl -v http://127.0.0.1:8000/api/videos/alipay

# æµ‹è¯•å¾®ä¿¡è§†é¢‘ç«¯ç‚¹
curl -v http://127.0.0.1:8000/api/videos/wechat
```

**é¢„æœŸç»“æœ**ï¼š
- å¦‚æœè§†é¢‘æœªé…ç½®ï¼š`404 Not Found` æˆ– `{"detail":"Alipay video not configured"}`
- å¦‚æœè§†é¢‘å·²é…ç½®ï¼šè¿”å› JSON åŒ…å«è§†é¢‘ URL
- å¦‚æœæ˜¯è®¤è¯é—®é¢˜ï¼š`401 Unauthorized`ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºéœ€è¦ Telegram initDataï¼‰

#### æµ‹è¯•å®Œæ•´çš„ API æµç¨‹ï¼ˆé€šè¿‡æµè§ˆå™¨ï¼‰

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`https://50zf.usdt2026.cc`
2. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰â†’ Network æ ‡ç­¾
3. ç‚¹å‡»æ”¯ä»˜å®æˆ–å¾®ä¿¡æ”¯ä»˜çš„"è§‚çœ‹è§†é¢‘æ•™ç¨‹"æŒ‰é’®
4. æ£€æŸ¥ç½‘ç»œè¯·æ±‚ï¼š
   - åº”è¯¥çœ‹åˆ°å¯¹ `/api/videos/alipay` æˆ– `/api/videos/wechat` çš„è¯·æ±‚
   - å¦‚æœè¿”å› 502ï¼Œè¯´æ˜ API æœåŠ¡æœªè¿è¡Œæˆ–é…ç½®é”™è¯¯
   - å¦‚æœè¿”å› 404ï¼Œè¯´æ˜è§†é¢‘æœªé…ç½®ï¼ˆéœ€è¦åœ¨ Bot ä¸­ä¸Šä¼ è§†é¢‘åˆ°é¢‘é“ï¼‰

### 4. æ£€æŸ¥ç«¯å£ç›‘å¬

```bash
sudo netstat -tlnp | grep 8000
# æˆ–
sudo ss -tlnp | grep 8000
```

**é¢„æœŸç»“æœ**ï¼š
- çœ‹åˆ° `127.0.0.1:8000` æ­£åœ¨ç›‘å¬
- è¿›ç¨‹æ˜¯ Python

### 5. æµ‹è¯•ä» Nginx ä»£ç†è®¿é—®

```bash
# é€šè¿‡ HTTPS è®¿é—®ï¼ˆéœ€è¦ Telegram initDataï¼Œå¯èƒ½è¿”å› 401ï¼‰
curl -v https://50zf.usdt2026.cc/api/

# æµ‹è¯•å‰ç«¯é¡µé¢
curl -I https://50zf.usdt2026.cc
```

**é¢„æœŸç»“æœ**ï¼š
- å‰ç«¯é¡µé¢ï¼š`200 OK`
- API ç«¯ç‚¹ï¼šå¯èƒ½éœ€è¦è®¤è¯ï¼Œä½†è‡³å°‘åº”è¯¥èƒ½è¿æ¥ï¼ˆä¸æ˜¯ 502ï¼‰

## ğŸ”§ å¦‚æœæœåŠ¡å¯åŠ¨å¤±è´¥

### å¸¸è§é—®é¢˜ 1: status=203/EXEC

**åŸå› **ï¼šPython è·¯å¾„ä¸æ­£ç¡®æˆ–è™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨

**ä¿®å¤**ï¼š
```bash
# è¿è¡Œè¯Šæ–­è„šæœ¬
cd ~
wget https://raw.githubusercontent.com/victor2025PH/wushizhifu/main/deploy/è¯Šæ–­å¹¶ä¿®å¤APIæœåŠ¡.sh
chmod +x è¯Šæ–­å¹¶ä¿®å¤APIæœåŠ¡.sh
./è¯Šæ–­å¹¶ä¿®å¤APIæœåŠ¡.sh
```

### å¸¸è§é—®é¢˜ 2: æ¨¡å—æœªæ‰¾åˆ°

**åŸå› **ï¼šä¾èµ–æœªå®‰è£…

**ä¿®å¤**ï¼š
```bash
cd /home/ubuntu/wushizhifu
source venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart wushipay-api
```

### å¸¸è§é—®é¢˜ 3: æ•°æ®åº“é”™è¯¯

**åŸå› **ï¼šæ•°æ®åº“è¡¨æœªåˆ›å»º

**ä¿®å¤**ï¼š
```bash
cd /home/ubuntu/wushizhifu
source venv/bin/activate
python3 -c "from database.models import init_database; init_database()"
sudo systemctl restart wushipay-api
```

## ğŸ“‹ å®Œæ•´éªŒè¯æ¸…å•

- [ ] æœåŠ¡çŠ¶æ€ï¼š`sudo systemctl status wushipay-api` æ˜¾ç¤º `active (running)`
- [ ] ç«¯å£ç›‘å¬ï¼š`netstat -tlnp | grep 8000` æ˜¾ç¤º Python è¿›ç¨‹
- [ ] API å¥åº·æ£€æŸ¥ï¼š`curl http://127.0.0.1:8000/` è¿”å› JSON
- [ ] å‰ç«¯é¡µé¢ï¼šè®¿é—® `https://50zf.usdt2026.cc` æ­£å¸¸æ˜¾ç¤º
- [ ] è§†é¢‘ç«¯ç‚¹ï¼šè™½ç„¶å¯èƒ½è¿”å› 404ï¼Œä½†ä¸åº”è¯¥æ˜¯ 502

## ğŸ¯ ä¸‹ä¸€æ­¥ï¼šé…ç½®è§†é¢‘

å¦‚æœ API æœåŠ¡æ­£å¸¸ä½†è§†é¢‘è¿”å› 404ï¼Œéœ€è¦ï¼š

1. **é€šè¿‡ Bot A ä¸Šä¼ è§†é¢‘åˆ°é¢‘é“**
   - åœ¨æŒ‡å®šçš„ Telegram é¢‘é“ä¸Šä¼ è§†é¢‘
   - Bot ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æç¤ºé€‰æ‹©è§†é¢‘ç±»å‹ï¼ˆæ”¯ä»˜å®/å¾®ä¿¡ï¼‰
   - é€‰æ‹©åè§†é¢‘é…ç½®ä¼šä¿å­˜åˆ°æ•°æ®åº“

2. **æ‰‹åŠ¨é…ç½®è§†é¢‘**ï¼ˆå¦‚æœ Bot A æœªè¿è¡Œï¼‰
   - éœ€è¦çŸ¥é“è§†é¢‘çš„ file_id
   - ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ’å…¥é…ç½®

å®Œæˆåï¼Œè§†é¢‘ç«¯ç‚¹å°†è¿”å›æ­£ç¡®çš„è§†é¢‘ URLã€‚

