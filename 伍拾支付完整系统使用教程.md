# 伍拾支付完整系统使用教程

## 📖 目录

1. [系统概述](#系统概述)
2. [MiniApp 使用教程](#miniapp-使用教程)
3. [Bot A 使用教程](#bot-a-使用教程)
4. [Bot B 使用教程](#bot-b-使用教程)
5. [三者配合使用场景](#三者配合使用场景)
6. [常见问题解答](#常见问题解答)

---

## 系统概述

### 🎯 系统架构

伍拾支付系统由三个核心组件组成：

```
┌─────────────────────────────────────────────────────┐
│           伍拾支付系统（WuShiPay System）              │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────┐  ┌──────────────┐  ┌─────────────┐│
│  │   Bot A      │  │   Bot B      │  │   MiniApp   ││
│  │              │  │              │  │             ││
│  │ 支付网关系统  │  │ OTC结算工具   │  │ Web小程序   ││
│  └──────────────┘  └──────────────┘  └─────────────┘│
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 📊 系统定位对比

| 组件 | 定位 | 核心用途 | 主要用户 |
|------|------|---------|---------|
| **MiniApp** | Web 小程序界面 | 提供完整的支付界面和用户体验 | 所有用户 |
| **Bot A** | 支付网关系统 | 在线支付、钱包管理、用户管理 | 商户、普通用户 |
| **Bot B** | OTC 交易结算工具 | 场外交易结算、汇率查询、账单管理 | OTC 交易者、群组管理员 |

---

## MiniApp 使用教程

### 📱 什么是 MiniApp？

MiniApp 是一个基于 Telegram WebApp 技术的 Web 小程序，提供完整的支付界面和用户体验。用户可以在 Telegram 内直接打开，无需离开聊天环境。

### 🚀 如何打开 MiniApp？

**方式一：通过 Bot A**
1. 在 Bot A 私聊中，点击「💎 启动伍拾收银台」按钮
2. MiniApp 会自动打开

**方式二：通过 Bot B**
1. 在 Bot B 聊天中（群组或私聊），点击底部「💎 打开应用」按钮
2. MiniApp 会自动打开

**方式三：通过菜单按钮**
1. 在 Bot A 或 Bot B 聊天中
2. 点击输入框左侧的菜单按钮（⚙️）
3. 选择「打开应用」或「Launch App」

### ✨ MiniApp 核心功能

#### 1. **支付功能**
- 💳 **支付宝支付**：选择支付宝通道进行支付
- 🍀 **微信支付**：选择微信支付通道进行支付
- 📊 **支付引导**：提供视频引导教程
- ⏱️ **支付倒计时**：显示支付有效期

**使用流程**：
```
打开 MiniApp → 选择支付通道 → 输入金额 → 查看支付二维码/链接 → 完成支付
```

#### 2. **钱包管理**
- 💰 **余额查询**：查看账户余额
- 📈 **充值功能**：向钱包充值
- 💸 **提现功能**：从钱包提现

**使用流程**：
```
打开 MiniApp → 点击「钱包」标签 → 查看余额/充值/提现
```

#### 3. **交易记录**
- 📜 **历史记录**：查看所有交易历史
- 🔍 **记录筛选**：按时间、状态筛选
- 📊 **交易详情**：查看每笔交易的详细信息

**使用流程**：
```
打开 MiniApp → 点击「历史」标签 → 查看交易记录 → 点击查看详情
```

#### 4. **计算器功能**
- 🧮 **费率计算**：计算支付手续费
- 💱 **汇率换算**：货币汇率换算

**使用流程**：
```
打开 MiniApp → 点击「计算器」按钮 → 输入金额 → 查看计算结果
```

#### 5. **个人设置**
- 🌐 **语言切换**：中英文切换
- 🔔 **通知设置**：管理通知偏好
- 👤 **个人资料**：查看和编辑个人信息

**使用流程**：
```
打开 MiniApp → 点击「个人」标签 → 进入设置页面
```

### 📖 MiniApp 使用场景

#### 场景 1：快速支付
```
用户想要支付 → 打开 MiniApp → 选择支付方式 → 输入金额 → 完成支付
```

**适用情况**：
- 需要快速完成支付
- 需要查看支付二维码
- 需要查看支付状态

#### 场景 2：查看交易记录
```
用户想查看历史交易 → 打开 MiniApp → 进入「历史」页面 → 查看记录
```

**适用情况**：
- 需要查看详细的交易信息
- 需要导出交易记录
- 需要筛选和搜索交易

#### 场景 3：管理钱包
```
用户想管理资金 → 打开 MiniApp → 进入「钱包」页面 → 充值/提现
```

**适用情况**：
- 需要查看账户余额
- 需要充值到钱包
- 需要从钱包提现

---

## Bot A 使用教程

### 🤖 什么是 Bot A？

Bot A 是伍拾支付的支付网关系统，主要负责在线支付、钱包管理、用户管理和群组管理。

### 🎯 Bot A 核心功能

#### 1. **支付管理**

**功能说明**：
- 💳 支付宝支付通道
- 🍀 微信支付通道
- 📊 支付统计和报表

**使用方式**：

**方式一：通过按钮**
```
与 Bot A 私聊 → 点击「💳 支付宝通道」或「🍀 微信通道」 → 选择支付类型 → 完成支付
```

**方式二：通过 MiniApp**
```
点击「💎 启动伍拾收银台」 → 在 MiniApp 中选择支付方式
```

**管理员命令**：
```
/pay_ali - 管理支付宝支付
/pay_wechat - 管理微信支付
```

#### 2. **钱包系统**

**功能说明**：
- 💰 余额查询
- 💳 充值功能
- 💸 提现功能
- 📊 钱包统计

**使用方式**：
```
与 Bot A 私聊 → 点击「💰 我的钱包」按钮 → 查看余额/充值/提现
```

#### 3. **交易记录**

**功能说明**：
- 📜 查看所有交易记录
- 🔍 搜索和筛选交易
- 📊 交易统计

**使用方式**：
```
与 Bot A 私聊 → 点击「📜 交易记录」按钮 → 查看历史记录
```

#### 4. **计算器**

**功能说明**：
- 🧮 费率计算
- 💱 汇率换算

**使用方式**：
```
与 Bot A 私聊 → 点击「🧮 计算器」按钮 → 输入金额 → 查看计算结果
```

#### 5. **用户管理**（管理员功能）

**功能说明**：
- 👥 用户搜索
- 📊 用户报表
- ⏰ 时间统计
- 📈 详细报表

**管理员命令**：
```
/admin - 进入管理员菜单
/usersearch [关键词] - 搜索用户
/userreport - 查看用户报表
/timestats - 查看时间统计
/detailedreport - 查看详细报表
```

#### 6. **群组管理**

**功能说明**：
- ✅ 智能群组验证（问答机制）
- 🚫 敏感词过滤
- 👥 群组成员管理
- ⚙️ 群组设置

**管理员命令**：
```
/addgroup [群组ID] - 添加群组
/grouplist - 查看群组列表
/addsensitive [敏感词] - 添加敏感词
/delsensitive [敏感词] - 删除敏感词
```

**群组验证流程**：
```
新成员加入群组 → Bot A 自动发送验证问题 → 用户回答 → 验证通过/失败
```

**敏感词过滤**：
```
用户发送消息 → Bot A 检测敏感词 → 自动删除/警告/封禁
```

#### 7. **视频配置**（管理员功能）

**功能说明**：
- 📹 配置支付宝引导视频
- 📹 配置微信支付引导视频
- 📋 视频管理

**管理员命令**：
```
/videoconfig - 配置引导视频
```

**配置流程**：
```
管理员 → /videoconfig → 选择支付类型 → 上传视频到频道 → 选择视频 → 完成配置
```

详细配置方法请参考：[视频配置使用指南](botA/视频配置使用指南.md)

### 📖 Bot A 使用场景

#### 场景 1：用户在线支付
```
用户 → 与 Bot A 私聊 → 点击「💳 支付宝通道」 → 选择支付类型 → 输入金额 → 完成支付
```

#### 场景 2：用户查看交易记录
```
用户 → 与 Bot A 私聊 → 点击「📜 交易记录」 → 查看历史记录 → 筛选/搜索
```

#### 场景 3：管理员管理用户
```
管理员 → 与 Bot A 私聊 → /admin → 用户管理 → 搜索用户/查看报表
```

#### 场景 4：群组自动验证
```
新成员加入群组 → Bot A 自动发送验证问题 → 用户回答 → 验证通过
```

#### 场景 5：敏感词自动过滤
```
用户在群组发送消息 → Bot A 检测敏感词 → 自动删除/警告
```

---

## Bot B 使用教程

### 🤖 什么是 Bot B？

Bot B 是 OTC（场外交易）群组管理工具，主要负责汇率查询、结算计算、账单管理和价格管理。

### 🎯 Bot B 核心功能

#### 1. **汇率查询**

**功能说明**：
- 💱 实时汇率查询（Binance P2P 数据源）
- 📊 商户报价列表
- 🔄 支持银行卡、支付宝、微信等支付渠道
- 📈 价格趋势图表

**使用方式**：

**方式一：通过按钮**
```
在 Bot B 聊天中 → 点击「💱 汇率」按钮 → 查看实时汇率和商户报价
```

**方式二：通过命令**
```
/price - 查看实时汇率
```

**方式三：通过快捷指令**（管理员）
```
w1 或 HL - 查看价格详情
```

**汇率显示内容**：
- 🟢 实时币价行情
- 📅 更新时间
- 💳 支付渠道（银行卡/支付宝/微信）
- 💰 商户报价列表（价格、限额、成单数）
- 📊 市场统计数据（最低价、最高价、平均价、成单率）

#### 2. **结算计算**

**功能说明**：
- 🧮 自动计算 CNY → USDT 结算
- 📋 生成格式化结算账单
- 💰 支持金额模板和算式模板
- 📊 批量结算功能

**使用方式**：

**方式一：直接输入金额**
```
用户输入：20000
Bot B 回复：显示结算账单（20000 CNY → 对应 USDT 数量）
```

**方式二：输入算式**
```
用户输入：20000-200
Bot B 计算：19800 CNY → 对应 USDT 数量
```

**方式三：使用模板**
```
点击「💰 结算」按钮 → 选择「金额模板」或「算式模板」 → 选择模板 → 自动计算
```

**结算账单格式**：
```
🧾 交易结算单
────────────────────────
💰 数量: 2,000.00 U
📊 汇率: 7.7345 (Binance P2P: 7.2345 +加价: 0.5000)
🇨🇳 应付: 15,469.00 CNY
────────────────────────
🔗 地址: TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t
```

#### 3. **账单查询**

**功能说明**：
- 📊 今日账单统计（群组）
- 📜 历史账单查询
- 🔍 高级筛选（金额、日期、状态、用户）
- 📥 数据导出（CSV/Excel）

**使用方式**：

**群组中**：
```
点击「📊 今日」按钮 - 查看今日账单统计
点击「📜 历史」按钮 - 查看历史账单列表
```

**私聊中**：
```
点击「📜 我的账单」按钮 - 查看个人所有交易记录
```

**管理员功能**：
- 📊 群组统计（群组中点击「📈 统计」）
- 📊 全局统计（私聊中点击「📊 数据」）
- ⏳ 待支付交易管理
- ✅ 待确认交易管理

#### 4. **价格管理**（管理员功能）

**功能说明**：
- ⚙️ 群组加价设置
- 🌐 全局加价设置
- 📍 USDT 地址管理
- 🔄 价格历史记录

**管理员命令**：

**群组管理**：
```
w0 或 SZ - 查看群组设置
w2 [数字] 或 SJJ [数字] - 设置群组加价（如：w2 0.5）
w3 [地址] 或 SDZ [地址] - 设置群组地址
w8 或 CZSZ - 重置群组设置
w9 或 SCSZ - 删除群组配置
```

**全局管理**（私聊中）：
```
w4 或 CKQJ - 查看全局设置
w5 [数字] 或 SQJJ [数字] - 设置全局加价
w6 [地址] 或 SQJDZ [地址] - 设置全局地址
w7 或 CKQL - 查看所有群组列表
```

**使用流程**：
```
管理员 → 点击「⚙️ 设置」或「⚙️ 管理」 → 进入设置菜单 → 设置加价/地址
```

#### 5. **交易生命周期管理**

**功能说明**：
- ⏳ 待支付状态
- 💰 已支付状态
- ✅ 已确认状态
- ❌ 已取消状态

**用户操作**：
- 💰 标记已支付
- ❌ 取消交易

**管理员操作**：
- ✅ 确认交易
- ⏳ 查看待支付交易列表
- ✅ 查看待确认交易列表
- ✅ 批量确认交易

**使用流程**：
```
用户生成结算账单 → 账单显示「待支付」状态 → 用户点击「💰 已支付」 → 
管理员查看「待确认」列表 → 管理员点击「✅ 确认交易」 → 交易完成
```

#### 6. **价格预警**（私聊功能）

**功能说明**：
- 🔔 价格高于阈值预警
- 📉 价格低于阈值预警
- 📊 价格历史图表
- 🔔 自动通知

**使用方式**：
```
在私聊中 → 点击「🔔 预警」按钮 → 创建预警 → 设置价格阈值 → 等待通知
```

#### 7. **模板功能**

**功能说明**：
- 💰 金额模板（常用金额快速输入）
- 🧮 算式模板（常用算式快速输入）
- 📝 自定义模板
- ⭐ 常用模板优先显示

**使用方式**：
```
点击「💰 结算」按钮 → 选择「金额模板」或「算式模板」 → 选择模板 → 自动计算
```

#### 8. **多地址管理**

**功能说明**：
- 📍 管理多个 USDT 收款地址
- 🏷️ 地址标签和备注
- ⭐ 设置默认地址
- 📊 地址使用统计

**使用方式**：
```
管理员 → 点击「⚙️ 设置」 → 「📍 地址管理」 → 添加/编辑/删除地址
```

#### 9. **数据可视化**（管理员功能）

**功能说明**：
- 📈 交易趋势图表
- 📊 交易量图表
- 👥 用户分布图表
- 💰 价格趋势图表

**使用方式**：
```
管理员 → 查看统计页面 → 点击图表按钮 → 查看可视化数据
```

### 📖 Bot B 使用场景

#### 场景 1：OTC 交易结算
```
用户在群组中 → 输入 "20000-200" → Bot B 计算 → 显示结算账单 → 用户转账 → 标记已支付
```

#### 场景 2：查询实时汇率
```
用户 → 点击「💱 汇率」按钮 → 查看 Binance P2P 实时报价 → 切换支付渠道查看不同报价
```

#### 场景 3：管理员设置群组加价
```
管理员在群组中 → 输入 "w2 0.5" → Bot B 设置群组加价为 0.5 → 后续结算使用新价格
```

#### 场景 4：查看交易记录
```
用户在群组中 → 点击「📜 历史」 → 查看历史账单 → 筛选/搜索 → 导出报表
```

#### 场景 5：价格预警
```
用户在私聊中 → 点击「🔔 预警」 → 创建预警 → 设置价格阈值 → 价格达到时自动通知
```

---

## 三者配合使用场景

### 🔄 系统关系图

```
┌─────────────────────────────────────────────────────────┐
│                   伍拾支付生态系统                         │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────┐      ┌──────────────┐      ┌─────────┐│
│  │   Bot A      │◄────►│   MiniApp    │◄────►│  Bot B  ││
│  │              │      │              │      │         ││
│  │ 支付网关      │      │ Web小程序     │      │ OTC结算  ││
│  │              │      │              │      │         ││
│  │ • 支付管理    │      │ • 支付界面    │      │ • 汇率查询││
│  │ • 钱包系统    │      │ • 钱包管理    │      │ • 结算计算││
│  │ • 用户管理    │      │ • 交易记录    │      │ • 账单管理││
│  │ • 群组验证    │      │ • 个人设置    │      │ • 价格管理││
│  └──────────────┘      └──────────────┘      └─────────┘│
│         │                     │                     │    │
│         └─────────────────────┴─────────────────────┘    │
│                           │                              │
│                    ┌──────▼──────┐                      │
│                    │ 共享数据层   │                      │
│                    │ • 管理员权限 │                      │
│                    │ • 用户数据   │                      │
│                    │ • 交易数据   │                      │
│                    └─────────────┘                      │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 🎯 典型使用场景

#### 场景 1：用户完成在线支付

**完整流程**：
```
1. 用户打开 Bot A 私聊
   ↓
2. 点击「💎 启动伍拾收银台」打开 MiniApp
   ↓
3. 在 MiniApp 中选择支付方式（支付宝/微信）
   ↓
4. 输入支付金额
   ↓
5. 查看支付二维码/链接
   ↓
6. 完成支付
   ↓
7. Bot A 记录交易订单
   ↓
8. MiniApp 显示支付结果
```

**涉及的组件**：
- ✅ Bot A：处理支付逻辑和订单管理
- ✅ MiniApp：提供支付界面和用户体验

#### 场景 2：OTC 交易群组结算

**完整流程**：
```
1. 用户在 OTC 交易群组中
   ↓
2. 群组中有 Bot B
   ↓
3. 用户输入 CNY 金额："20000-200"
   ↓
4. Bot B 查询实时汇率（Binance P2P）
   ↓
5. Bot B 计算应结算的 USDT 数量
   ↓
6. Bot B 生成格式化结算账单
   ↓
7. 用户查看账单并转账
   ↓
8. 用户点击「💰 已支付」
   ↓
9. 管理员查看「待确认」列表
   ↓
10. 管理员点击「✅ 确认交易」
    ↓
11. Bot B 记录交易并更新统计
```

**涉及的组件**：
- ✅ Bot B：处理结算计算和账单管理

#### 场景 3：管理员统一管理

**完整流程**：
```
1. 管理员在 Bot A 中添加新管理员
   ↓
2. Bot A 更新管理员数据库
   ↓
3. Bot B 自动识别新管理员权限
   ↓
4. 新管理员可以在两个 Bot 中使用管理员功能
```

**涉及的组件**：
- ✅ Bot A：管理员权限管理
- ✅ Bot B：读取 Bot A 的管理员数据

#### 场景 4：用户同时使用多个组件

**完整流程**：
```
用户场景：既有在线支付需求，也有 OTC 交易需求

1. 在线支付：
   用户 → Bot A → MiniApp → 完成支付

2. OTC 交易：
   用户 → Bot B 群组 → 结算计算 → 完成交易

3. 查看记录：
   - 在线支付记录：Bot A 或 MiniApp
   - OTC 交易记录：Bot B
```

**涉及的组件**：
- ✅ Bot A：处理在线支付
- ✅ MiniApp：提供支付界面
- ✅ Bot B：处理 OTC 交易

### 📊 功能对比表

| 功能 | MiniApp | Bot A | Bot B |
|------|---------|-------|-------|
| **支付功能** | ✅ 完整界面 | ✅ 支付管理 | ❌ |
| **钱包管理** | ✅ 完整界面 | ✅ 钱包系统 | ❌ |
| **交易记录** | ✅ 查看记录 | ✅ 订单管理 | ✅ 账单管理 |
| **汇率查询** | ❌ | ❌ | ✅ Binance P2P |
| **结算计算** | ❌ | ❌ | ✅ CNY→USDT |
| **群组验证** | ❌ | ✅ 智能验证 | ❌ |
| **敏感词过滤** | ❌ | ✅ 自动过滤 | ❌ |
| **价格管理** | ❌ | ❌ | ✅ 加价/地址 |
| **用户管理** | ❌ | ✅ 完整管理 | ❌ |
| **数据可视化** | ❌ | ✅ 支付统计 | ✅ 交易统计 |

### 🔗 快速访问方式

**打开 MiniApp**：
- 在 Bot A 中：点击「💎 启动伍拾收银台」按钮
- 在 Bot B 中：点击「💎 打开应用」按钮
- 通过菜单：点击输入框左侧菜单按钮 → 选择「打开应用」

**切换到 Bot A**：
- 在 Bot B 中：点击「📞 客服」按钮，获取 Bot A 联系方式

**切换到 Bot B**：
- 在 Bot A 中：通过帮助信息了解 Bot B 用途

---

## 常见问题解答

### ❓ MiniApp 相关

**Q1: MiniApp 打不开怎么办？**

A: 请检查以下几点：
1. 确保在 Telegram 应用中打开（不支持浏览器）
2. 确保网络连接正常
3. 尝试重新点击「💎 打开应用」按钮
4. 如果仍然无法打开，请联系客服

**Q2: MiniApp 支持哪些语言？**

A: MiniApp 支持：
- 中文（简体）
- 英文

可以在 MiniApp 中点击「🌐」图标切换语言。

**Q3: MiniApp 中的数据与 Bot 同步吗？**

A: 是的，MiniApp 和 Bot A 共享数据：
- 交易记录实时同步
- 钱包余额实时同步
- 用户设置同步

### ❓ Bot A 相关

**Q4: 如何添加 Bot A 为管理员？**

A: 在 Bot A 私聊中，使用管理员命令：
```
/addadmin [用户ID]
```

**Q5: 如何配置群组验证？**

A: 在 Bot A 管理员菜单中：
```
/addgroup [群组ID] - 添加群组
然后配置验证规则
```

**Q6: 敏感词过滤如何工作？**

A: Bot A 会自动检测群组消息中的敏感词：
- 可以设置警告、删除、封禁三种处理方式
- 使用 `/addsensitive [敏感词]` 添加敏感词
- 使用 `/delsensitive [敏感词]` 删除敏感词

### ❓ Bot B 相关

**Q7: 如何设置群组加价？**

A: 在群组中，管理员输入：
```
w2 0.5  （设置加价为 0.5）
```

或使用拼音快捷指令：
```
SJJ 0.5  （设置加价的拼音首字母）
```

**Q8: 如何查看所有群组列表？**

A: 在私聊中，管理员：
1. 点击「⚙️ 管理」按钮
2. 选择「📊 所有群组列表」

或使用命令：
```
w7 或 CKQL
```

**Q9: 结算计算是如何工作的？**

A: Bot B 的计算逻辑：
1. 用户输入 CNY 金额（如：20000-200 = 19800）
2. Bot B 查询 Binance P2P 实时汇率
3. 加上管理员设置的加价（群组或全局）
4. 计算应结算的 USDT 数量：USDT = CNY / (汇率 + 加价)

**Q10: 如何导出交易记录？**

A: 在群组中，管理员：
1. 点击「📜 历史」按钮
2. 点击「🔍 高级筛选」（可选）
3. 点击「📥 导出 CSV」或「📥 导出 Excel」

### ❓ 系统配合相关

**Q11: Bot A 和 Bot B 可以同时在同一个群组吗？**

A: 可以！两者功能不冲突：
- Bot A 负责群组验证和敏感词过滤
- Bot B 负责结算计算和汇率查询

**Q12: 管理员权限是否共享？**

A: 是的，Bot A 和 Bot B 共享管理员列表：
- 在 Bot A 中添加的管理员，Bot B 自动识别
- 在 Bot B 中添加的管理员，需要确保在 Bot A 的数据库中存在

**Q13: 交易数据是否共享？**

A: 当前交易数据独立：
- Bot A：记录在线支付订单
- Bot B：记录 OTC 交易结算账单

未来可能会考虑数据互通。

---

## 📚 相关文档

- [Bot A 视频配置使用指南](botA/视频配置使用指南.md)
- [Bot B UI 功能说明](botB/UI功能说明.md)
- [Bot A 与 Bot B 功能对比](Bot%20A与Bot%20B功能对比与配合方案.md)

---

## 📞 获取帮助

如果遇到问题或需要帮助，请：

1. **查看文档**：先查看相关使用文档
2. **联系客服**：
   - 在 Bot A 或 Bot B 中点击「📞 客服」按钮
   - Telegram: @wushizhifu_jianglai
3. **查看日志**：如果是管理员，可以查看系统日志定位问题

---

## 🔄 版本更新

本文档会根据系统更新持续更新，请定期查看最新版本。

**最后更新**：2025-12-29

---

**祝您使用愉快！** ✨

